# -*- coding: utf-8 -*-
"""FAD.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ylZd1vRNDuM-K9LVC8DqQON1WJHTZSax
"""

!pip install frechet_audio_distance

from frechet_audio_distance import FrechetAudioDistance
from utils import gen_sine_wave

import os
import sys
import shutil
import numpy as np
import soundfile as sf

# to use `vggish`
frechet = FrechetAudioDistance(
    model_name="vggish",
    sample_rate=16000,
    use_pca=False,
    use_activation=False,
    verbose=False
)

"""to save embedings"""

# Specify the paths to your saved embeddings
background_embds_path = "/path/to/saved/background/embeddings.npy"
eval_embds_path = "/path/to/saved/eval/embeddings.npy"

# Compute FAD score while reusing the saved embeddings (or saving new ones if paths are provided and embeddings don't exist yet)
fad_score = frechet.score(
    "/path/to/background/set",
    "/path/to/eval/set",
    background_embds_path=background_embds_path,
    eval_embds_path=eval_embds_path,
    dtype="float32"
)

!pip install numpy tensorflow librosa

import numpy as np
import tensorflow as tf
import tensorflow_hub as hub
import librosa

# Load the VGGish model from TensorFlow Hub
vggish_model_url = "https://tfhub.dev/google/vggish/1"
vggish_embed = hub.load(vggish_model_url)

def extract_vggish_features(audio_path):
    # Load audio file using librosa
    y, sr = librosa.load(audio_path)

    # Pad or truncate the audio to 10 seconds
    target_length = 10 * sr
    y = librosa.util.fix_length(y, target_length)

    # Reshape the audio for VGGish input
    y_reshape = y.reshape(1, -1)

    # Extract VGGish embeddings
    embeddings = vggish_embed(y_reshape)

    # Reshape the embeddings to 2D array
    features = np.array(embeddings).reshape(-1)

    return features

# Example usage
audio_path1 = 'path/to/audio1.wav'
audio_path2 = 'path/to/audio2.wav'

# Extract VGGish features from audio files
features1 = extract_vggish_features(audio_path1)
features2 = extract_vggish_features(audio_path2)

# Calculate Euclidean distance between the feature vectors
distance = np.linalg.norm(features1 - features2)

print(f"VGGish Feature Distance: {distance}")